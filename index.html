<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼ï¼ˆãƒã‚ªãƒ³ãƒ–ãƒ«ãƒ¼ï¼‰</title>
<style>
  body {
    font-family: 'Segoe UI', sans-serif;
    background: linear-gradient(135deg, #0a0f1e, #000);
    color: #e0f7fa;
    text-align: center;
    padding: 20px;
    transition: background 0.5s ease;
  }
  body.break-mode {
    background: linear-gradient(135deg, #003311, #001a0d);
  }
  h1 {
    margin-bottom: 10px;
    text-shadow: 0 0 10px #00e5ff;
  }
  .guide {
    max-width: 700px;
    margin: 0 auto 20px auto;
    text-align: left;
    background: rgba(255, 255, 255, 0.05);
    padding: 10px;
    border-radius: 8px;
    border: 1px solid rgba(0, 229, 255, 0.3);
  }
  textarea, input {
    width: 80%;
    padding: 8px;
    margin: 5px 0;
    border-radius: 8px;
    border: 1px solid rgba(0, 229, 255, 0.5);
    background: rgba(255, 255, 255, 0.05);
    color: #e0f7fa;
    resize: none;
    backdrop-filter: blur(5px);
  }
  textarea:disabled {
    opacity: 0.6;
  }
  button {
    padding: 10px 16px;
    margin: 5px;
    border-radius: 8px;
    border: none;
    font-weight: bold;
    cursor: pointer;
    color: #e0f7fa;
    background: rgba(0, 229, 255, 0.1);
    border: 1px solid rgba(0, 229, 255, 0.5);
    box-shadow: 0 0 10px rgba(0, 229, 255, 0.2);
    transition: all 0.3s ease;
  }
  button:hover:not(:disabled) {
    box-shadow: 0 0 20px #00e5ff;
    background: rgba(0, 229, 255, 0.2);
  }
  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
  #timer {
    font-size: 72px;
    margin: 20px 0;
    font-weight: bold;
    color: #00e5ff;
    text-shadow: 0 0 20px #00e5ff;
    animation: glow 1.5s infinite alternate;
  }
  @keyframes glow {
    from { text-shadow: 0 0 10px #00e5ff; }
    to { text-shadow: 0 0 25px #00ffff; }
  }
  table {
    border-collapse: collapse;
    width: 90%;
    margin: 20px auto;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(0, 229, 255, 0.5);
    backdrop-filter: blur(4px);
  }
  th, td {
    border: 1px solid rgba(0, 229, 255, 0.3);
    padding: 6px;
    font-size: 14px;
  }
  th {
    background: rgba(0, 229, 255, 0.2);
  }
</style>
</head>
<body>
<h1>ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼</h1>
<div class="guide">
  <strong>ã€æ¦‚è¦ã€‘</strong><br>
  25åˆ†ä½œæ¥­ï¼‹5åˆ†ä¼‘æ†©ã®ã‚µã‚¤ã‚¯ãƒ«ã§é›†ä¸­åŠ›ã‚’é«˜ã‚ã¾ã™ã€‚<br>
  <strong>ã€ä½¿ã„æ–¹ã€‘</strong><br>
  1. ä½œæ¥­å‰ã«ç›®æ¨™ã‚’å…¥åŠ›ã—ã¦ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚<br>
  2. ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹ã§25åˆ†ä½œæ¥­ã€‚çµ‚äº†æ™‚ã«çŸ­ã„ãƒ¡ãƒ­ãƒ‡ã‚£ãŒæµã‚Œã¾ã™ã€‚<br>
  3. çµ‚äº†å¾Œã«é€²æ—ã‚’è¨˜å…¥ã—ã¦ä¿å­˜ã™ã‚‹ã¨ä¼‘æ†©5åˆ†ãŒè‡ªå‹•é–‹å§‹ã€‚<br>
  4. å±¥æ­´ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ã®ã¿ä¿å­˜ã•ã‚Œã€ä»–äººã‹ã‚‰ã¯è¦‹ãˆã¾ã›ã‚“ã€‚<br>
</div>
<textarea id="goal" rows="2" placeholder="ä»Šå›ã®ä½œæ¥­ç›®æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea><br>
<button id="lockGoal">ğŸ”’ ç›®æ¨™ã‚’ãƒ­ãƒƒã‚¯</button>
<div id="timer">25:00</div>
<button id="startPause" disabled>â–¶ é–‹å§‹</button>
<button id="reset">âŸ² ãƒªã‚»ãƒƒãƒˆ</button>
<h3>é€²æ—ãƒ¡ãƒ¢ï¼ˆä½œæ¥­çµ‚äº†å¾Œã«å…¥åŠ›ï¼‰</h3>
<textarea id="progress" rows="2" placeholder="ä½œæ¥­çµ‚äº†å¾Œã«é€²æ—ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„" disabled></textarea><br>
<button id="saveProgress" disabled>ğŸ’¾ ä¿å­˜ã—ã¦ä¼‘æ†©é–‹å§‹</button>
<h3>å±¥æ­´</h3>
<table id="historyTable">
  <thead><tr><th>æ—¥æ™‚</th><th>ç›®æ¨™</th><th>é€²æ—</th></tr></thead>
  <tbody></tbody>
</table>
<button id="downloadCSV">â¬‡ CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
<button id="clearHistory">ğŸ—‘ å±¥æ­´ã‚’å…¨æ¶ˆå»</button>
<audio id="endSound" preload="auto">
  <source src="data:audio/mp3;base64,SUQzAwAAAAAAFlRFTkMAAAAwAAAACAAADSxzdXJsAAAAAA==" type="audio/mp3">
</audio>
<script>
let timeLeft = 25 * 60;
let breakTime = 5 * 60;
let timerInterval;
let isRunning = false;
let mode = 'work';
let lockedGoal = '';
const timerDisplay = document.getElementById('timer');
const startPauseBtn = document.getElementById('startPause');
const goalInput = document.getElementById('goal');
const lockGoalBtn = document.getElementById('lockGoal');
const progressInput = document.getElementById('progress');
const saveProgressBtn = document.getElementById('saveProgress');
const endSound = document.getElementById('endSound');
function updateDisplay() {
  let min = String(Math.floor(timeLeft / 60)).padStart(2,'0');
  let sec = String(timeLeft % 60).padStart(2,'0');
  timerDisplay.textContent = `${min}:${sec}`;
}
function startPauseTimer() {
  if (!isRunning) {
    timerInterval = setInterval(() => {
      timeLeft--;
      updateDisplay();
      if (timeLeft <= 0) {
        clearInterval(timerInterval);
        isRunning = false;
        endSound.play();
        if (mode === 'work') {
          progressInput.disabled = false;
          saveProgressBtn.disabled = false;
          startPauseBtn.disabled = true;
        } else {
          document.body.classList.remove('break-mode');
          mode = 'work';
          timeLeft = 25 * 60;
          goalInput.disabled = false;
          goalInput.value = '';
          lockGoalBtn.disabled = false;
          lockedGoal = '';
          startPauseBtn.disabled = true;
          progressInput.value = '';
          progressInput.disabled = true;
          saveProgressBtn.disabled = true;
        }
      }
    }, 1000);
    isRunning = true;
    startPauseBtn.textContent = 'â¸ ä¸€æ™‚åœæ­¢';
  } else {
    clearInterval(timerInterval);
    isRunning = false;
    startPauseBtn.textContent = 'â–¶ é–‹å§‹';
  }
}
function resetTimer() {
  clearInterval(timerInterval);
  isRunning = false;
  mode = 'work';
  document.body.classList.remove('break-mode');
  timeLeft = 25 * 60;
  updateDisplay();
  startPauseBtn.textContent = 'â–¶ é–‹å§‹';
  goalInput.disabled = false;
  lockGoalBtn.disabled = false;
  startPauseBtn.disabled = true;
  progressInput.disabled = true;
  saveProgressBtn.disabled = true;
}
lockGoalBtn.onclick = () => {
  lockedGoal = goalInput.value.trim();
  if (!lockedGoal) { alert('ç›®æ¨™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  goalInput.disabled = true;
  lockGoalBtn.disabled = true;
  startPauseBtn.disabled = false;
};
startPauseBtn.onclick = startPauseTimer;
document.getElementById('reset').onclick = resetTimer;
saveProgressBtn.onclick = () => {
  let progress = progressInput.value.trim();
  let history = JSON.parse(localStorage.getItem('pomodoroHistory') || '[]');
  history.push([new Date().toLocaleString(), lockedGoal, progress]);
  localStorage.setItem('pomodoroHistory', JSON.stringify(history));
  renderHistory();
  mode = 'break';
  document.body.classList.add('break-mode');
  timeLeft = breakTime;
  progressInput.disabled = true;
  saveProgressBtn.disabled = true;
  startPauseBtn.disabled = false;
  startPauseTimer();
};
function renderHistory() {
  let tbody = document.querySelector('#historyTable tbody');
  tbody.innerHTML = '';
  let history = JSON.parse(localStorage.getItem('pomodoroHistory') || '[]');
  history.forEach(row => {
    let tr = document.createElement('tr');
    row.forEach(cell => {
      let td = document.createElement('td');
      td.textContent = cell;
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}
document.getElementById('downloadCSV').onclick = () => {
  let history = JSON.parse(localStorage.getItem('pomodoroHistory') || '[]');
  let rows = [['æ—¥æ™‚','ç›®æ¨™','é€²æ—'], ...history];
  const csv = rows.map(r => r.map(x => '"' + String(x || '').replaceAll('"','""') + '"').join(',')).join('\n');
  const blob = new Blob([csv], {type:'text/csv'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'pomodoro_history.csv';
  a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('clearHistory').onclick = () => {
  if (confirm('å±¥æ­´ã‚’å…¨ã¦å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
    localStorage.removeItem('pomodoroHistory');
    renderHistory();
  }
};
renderHistory();
updateDisplay();
</script>
</body>
</html>
